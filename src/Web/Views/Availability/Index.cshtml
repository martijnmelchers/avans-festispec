@model Festispec.Models.Availability
@{
    ViewData["Title"] = "Index";
}

<form asp-action="Index">
    <script>
        const data = @Html.Raw(ViewBag.SuccesBody);

        $(document).ready(function () {
            var Dates = [];
            $('.datepicker').datepicker({
                language: "nl",
                todayHighlight: true,
                clearBtn: true,
                multidate: true,
            });

            changeDaysBackground();
            $('.datepicker').on('changeDate', function (evt) {
                changeDaysBackground();
                console.log(evt.date);
                
                 });

            $('.btn').on('click', function () {
                changeDaysBackground();
                var the_date = $('.datepicker:first').datepicker('getDates').forEach(e => Dates.push(e.toLocaleDateString('nl-NL')));
                console.log(the_date);
                
                });

            $('#save').on('click', function (e) {
                e.preventDefault();
                console.log(Dates);
                $.ajax({
                    type: "POST",
                    url: "/Availability/Index",
                    data: { data: Dates }
                });
                setTimeout(() => window.location.href = '@Url.Action("Index", "Availability")', 1000);
                    
            });
        });

        function changeDaysBackground() {
            console.log("changeBackground");
            var days = $(".datepicker-days td");

            document.querySelectorAll(".datepicker-days td").forEach(i => {
               if(data[i.dataset.date] == 1)
                    $(i).addClass("change")

            });

        }
    </script>
    <style>
        .change {
            background-color: #FF4E4E;
        }
    </style>

    <div id="background-availability">
        <h1 id="availability-title">Beschikbaarheid</h1>
        <div class="datepicker" style="display: flex; justify-content: center; margin-bottom: 15px">

        </div>
        <div class="span5 col-md-5" id="sandbox-container">
            <p id="date-error" style="color : red ; font-weight: bold">@TempData["DateError"]</p>
            <div>
            </div>
        </div>

        <div class="legend-item">
            <span class="circle" style="background-color: #286090"></span> <p>Geselecteerd</p>
        </div>
        <div class="legend-item">
            <span class="circle" style="background-color: #FF4E4E"></span> <p>Niet beschikbaar</p>
        </div>
        <div class="legend-item">
            <span class="circle" style="background-color: #FFFFFF; border: solid 1px #707070"></span> <p>Beschikbaar</p>
        </div>

        <h2 class="availability-paragraph-title">Beschikbaarheid invullen</h2>
        <p class="availability-paragraph">
            Selecteer de dagen dat je niet beschikbaar bent,
            op deze dagen zullen wij je niet inplannen voor inspecties.
            <br/>
            Als je een dag selecteerd die is gemarkeerd als niet beschikbaar zal deze
            weer verandert worden naar beschikbaar.
        </p>
        <input type="submit" id="save" value="Opslaan" class="btn btn-primary" style="align-content: center; white-space: nowrap" />
    </div>

</form>

